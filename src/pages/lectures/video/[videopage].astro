---
export const prerender = false;

import BaseLayout from "../../../layout/BaseLayout.astro";
import VideoCard from "../../../componets/pageLectures/VideoCard.astro";
import Pagination from "../../../componets/Pagination.astro";
import { supabase } from "../../../lib/supabase.js";

const itemsPerPage = 3;
const videoPage = parseInt(Astro.params.videopage) || 1;

const { count: videoCount } = await supabase
.from("lectures")
.select("*", { count: "exact", head: true })
.eq("type", "video");

const videoTotalPages = Math.ceil(videoCount / itemsPerPage);
const videoStart = (videoPage - 1) * itemsPerPage;
const videoEnd = videoStart + itemsPerPage - 1;

const { data: videoLectures } = await supabase
.from("lectures")
.select("*")
.eq("type", "video")
.order("search_id", { ascending: true })
.range(videoStart, videoEnd);

const pageData = {
heading: "Lectures",
subHeading: "Engage with our latest audio and video lectures, curated for your learning journey",
};
---

<BaseLayout>
    <main class="min-h-screen bg-gray-50 pt-36 pb-24">
        {/* HEADER */}
        <div class="max-w-4xl mx-auto px-6 text-center">
            <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight text-gray-900">
                {pageData.heading}
            </h1>
            <p class="mt-4 text-lg md:text-xl text-gray-500 max-w-2xl mx-auto">
            {pageData.subHeading}
            </p>
        </div>

        {/* VIDEO LECTURES */}
        <section
                id="videos-section"
                class="max-w-3xl mx-auto px-6 mt-12 flex flex-col gap-8"
                >
                {videoLectures && videoLectures.length > 0 ? (
                videoLectures.map((lecture) => (
                <VideoCard
                lecture={lecture}
                class="w-full shadow-lg rounded-2xl border border-gray-200 transition hover:shadow-2xl"
                />
                ))
                ) : (
                <p class="text-gray-400 w-full text-center">No video lectures available.</p>
                )}
        </section>


        {/* PAGINATION */}
        <div class="mt-12 flex justify-center">
            <Pagination totalPages={videoTotalPages} currentPage={videoPage} baseUrl="/lectures/video" />
        </div>

    </main>

</BaseLayout>

