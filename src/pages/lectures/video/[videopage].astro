---
export const prerender = false;

import BaseLayout from "../../../layout/BaseLayout.astro";
import VideoCard from "../../../sections/lectures/VideoCard.astro";
import Pagination from "../../../componets/Pagination.astro";
import { supabase } from "../../../lib/supabase.js";

const itemsPerPage = 3;
const videoPage = parseInt(Astro.params.videopage) || 1;

const { count: videoCount } = await supabase
.from("lectures")
.select("*", { count: "exact", head: true })
.eq("type", "video");

const videoTotalPages = Math.ceil(videoCount / itemsPerPage);
const videoStart = (videoPage - 1) * itemsPerPage;
const videoEnd = videoStart + itemsPerPage - 1;

const { data: videoLectures } = await supabase
.from("lectures")
.select("*")
.eq("type", "video")
.order("search_id", { ascending: true })
.range(videoStart, videoEnd);

const pageData = {
heading: "Lectures",
subHeading: "Engage with our latest audio and video lectures, curated for your learning journey",
};
---
<BaseLayout>
  <main class="min-h-screen bg-gray-50 pt-36 pb-24">

    <!-- HEADER -->
    <div class="max-w-4xl mx-auto px-6 text-center mb-16">
      <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold text-gray-900 leading-snug">
        {pageData.heading}
      </h1>
      <p class="mt-4 text-gray-500 text-base sm:text-lg md:text-xl max-w-2xl mx-auto leading-relaxed">
        {pageData.subHeading}
      </p>
    </div>

    <!-- VIDEO LECTURES -->
    <section class="max-w-4xl mx-auto px-6 flex flex-col gap-8">
      {videoLectures && videoLectures.length > 0 ? (
        videoLectures.map((lecture) => (
          <VideoCard
            lecture={lecture}
            class="w-full bg-white rounded-3xl border border-gray-200 shadow-sm sm:shadow-md overflow-hidden"
          />
        ))
      ) : (
        <p class="text-gray-400 text-center">No video lectures available.</p>
      )}
    </section>

    <!-- PAGINATION -->
    <div class="mt-12 flex justify-center">
      <Pagination 
        totalPages={videoTotalPages} 
        currentPage={videoPage} 
        baseUrl="/lectures/video"
        class="text-gray-700" 
      />
    </div>

  </main>
</BaseLayout>

