---

import BaseLayout from "../../layout/BaseLayout.astro";
import ReadContent from "../../components/ReadContents.astro";


import NotFound from "../../components/NotFound.astro";
const button404 = [
  { href: "/", text: "Goto Home", type: "primary" },
  { href: "/notifications/1", text: "Explore Notifications", type: "tertiary" },
];

import { supabase } from "../../lib/supabase.js";
import DOMPurify from "isomorphic-dompurify";

const { slug } = Astro.params;

const { data: post, error } = await supabase
  .from("notifications")
  .select("*")
  .eq("url_slug", slug)
  .single();

if (error) console.error(error);

const formattedDate = post ? new Date(post.date_onsite).toLocaleDateString("en-GB", { day: "numeric", month: "long", year: "numeric" }) : null;
const safeBody = post?.body ? DOMPurify.sanitize(post.body) : "";
const safeUrdu = post?.urdu_translation ? DOMPurify.sanitize(post.urdu_translation) : "";
---
<BaseLayout>
  {!post ? (
    <NotFound buttons={button404} />
  ) : (
    <ReadContent
      title={post.title}
      category={post.category}
      badges={post.featured ? ["Featured"] : []}
      date={formattedDate}
      author={post.author}
      opening={post.opening || post.excerpt}
      openingTitle={post.opening_titlle || "Notification"}
      body={safeBody}
      bodyTitle={post.body_title || "Details"}
      urdu={safeUrdu}
      images={post.image_url ? [post.image_url] : []}
      backHref="/notifications/1"
      backText="Explore All Notifications"
    />
  )}
</BaseLayout>

